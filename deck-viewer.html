<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Deck Viewer - Lega dello Stretto">
    <title>Deck Viewer - Lega dello Stretto</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- CSS personalizzato -->
    <link rel="stylesheet" href="assets/css/one-piece-styles.css">
</head>

<body>
    <!-- Header -->
    <header class="main-header">
        <div class="container header-container">
        </div>
        </section>

        <!-- Deck Viewer Section -->
        <section class="section-container fade-in">
            <div class="container">
                <div class="deck-viewer-container" style="max-width: 900px; margin: 0 auto;">

                    <!-- Lookup Panel -->
                    <section class="panel"
                        style="margin-bottom: 12px; padding: 20px; background-color: var(--card-bg); border-radius: var(--border-radius);"
                        aria-labelledby="lookupTitle">
                        <h3 style="margin-top: 0; margin-bottom: 15px; color: var(--primary-color);">Cerca Scheda</h3>
                        <div style="display:grid; grid-template-columns: 1fr auto; gap: 10px; align-items:end;">
                            <div class="field">
                                <label for="codeInput" style="display: block; margin-bottom: 5px;">Inserisci codice
                                    scheda
                                    per visualizzare/modificare</label>
                                <input id="codeInput" type="text" placeholder="Incolla codice (ID) della scheda"
                                    class="form-control"
                                    style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid var(--border-color); background-color: var(--input-bg); color: var(--text-color);" />
                            </div>
                            <button id="loadBtn" class="btn btn-secondary" style="padding: 10px 20px;">Carica</button>
                        </div>
                    </section>

                    <!-- Form Panel -->
                    <section class="panel"
                        style="padding: 20px; background-color: var(--card-bg); border-radius: var(--border-radius);"
                        aria-labelledby="formTitle">
                        <form id="cardForm" novalidate>
                            <h2 id="formTitle" style="margin-top: 0; margin-bottom: 20px; color: var(--primary-color);">
                                Crea
                                o modifica scheda</h2>
                            <input type="hidden" id="editingId" value="" />

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                <div class="field">
                                    <label for="nome" style="display: block; margin-bottom: 5px;">Nome <span
                                            class="error" style="color: var(--danger);">*</span></label>
                                    <input id="nome" type="text" placeholder="Inserisci nome" required
                                        class="form-control"
                                        style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid var(--border-color); background-color: var(--input-bg); color: var(--text-color);" />
                                    <div id="nomeError" class="error"
                                        style="color: var(--danger); font-size: 0.9rem; margin-top: 5px;"></div>
                                </div>
                                <div class="field">
                                    <label for="cognome" style="display: block; margin-bottom: 5px;">Cognome <span
                                            class="error" style="color: var(--danger);">*</span></label>
                                    <input id="cognome" type="text" placeholder="Inserisci cognome" required
                                        class="form-control"
                                        style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid var(--border-color); background-color: var(--input-bg); color: var(--text-color);" />
                                    <div id="cognomeError" class="error"
                                        style="color: var(--danger); font-size: 0.9rem; margin-top: 5px;"></div>
                                </div>
                            </div>

                            <div class="field" style="margin-bottom: 20px;">
                                <label for="torneo" style="display: block; margin-bottom: 5px;">Torneo
                                    (opzionale)</label>
                                <input id="torneo" type="text" placeholder="Inserisci il nome del torneo (opzionale)"
                                    class="form-control"
                                    style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid var(--border-color); background-color: var(--input-bg); color: var(--text-color);" />
                            </div>

                            <div class="field" style="margin-bottom: 20px;">
                                <label for="immagine" style="display: block; margin-bottom: 5px;">Immagine Deck List
                                    (JPG/PNG) <span class="hint"
                                        style="font-size: 0.85rem; color: var(--text-secondary);">Max
                                        10MB</span></label>
                                <input id="immagine" type="file" accept="image/*" class="form-control"
                                    style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid var(--border-color); background-color: var(--input-bg); color: var(--text-color);" />
                                <div id="immagineError" class="error"
                                    style="color: var(--danger); font-size: 0.9rem; margin-top: 5px;"></div>
                                <div id="uploadStatus" class="hint"
                                    style="margin-top:6px; display:none; color: var(--text-secondary);">Caricamento...
                                </div>
                                <div id="uploadProgress"
                                    style="height:4px; background:#1f2937; border-radius:2px; overflow:hidden; display:none; margin-top: 5px;">
                                    <div id="uploadProgressBar"
                                        style="height:100%; width:0%; background:var(--primary-color); transition: width .25s;">
                                    </div>
                                </div>
                            </div>

                            <div class="preview" id="previewWrapper" hidden
                                style="margin-bottom: 20px; display: flex; align-items: center; gap: 15px;">
                                <img id="previewImg" alt="Anteprima immagine"
                                    style="width: 120px; height: 120px; border-radius: 10px; object-fit: cover; border: 1px solid var(--border-color);" />
                                <div class="hint" style="color: var(--text-secondary);">Anteprima immagine caricata
                                </div>
                            </div>

                            <div class="actions"
                                style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                                <button type="submit" class="btn btn-primary" id="submitBtn"
                                    style="padding: 10px 20px;">Salva scheda</button>
                                <button type="button" class="btn btn-secondary" id="resetBtn"
                                    style="padding: 10px 20px;">Reset</button>
                                <div class="hint" style="font-size: 0.85rem; color: var(--text-secondary);">Dopo il
                                    salvataggio ti verr√† mostrato il codice della scheda.</div>
                            </div>

                            <div id="formFeedback" class="banner" hidden
                                style="margin-top: 15px; padding: 10px; border-radius: 5px;"></div>
                        </form>
                    </section>

                    <!-- Code Section -->
                    <section id="codeSection" class="panel"
                        style="margin-top:12px; display:none; padding: 20px; background-color: var(--card-bg); border-radius: var(--border-radius);"
                        aria-labelledby="codeTitle">
                        <div
                            style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
                            <div>
                                <div class="hint" id="codeTitle"
                                    style="margin-bottom: 5px; color: var(--text-secondary);">
                                    Codice della scheda (usa per visualizzare/modificare):</div>
                                <div id="codeValue" class="codeOut"
                                    style="font-family: monospace; background: var(--input-bg); padding: 10px; border-radius: 5px; border: 1px dashed var(--border-color);">
                                </div>
                            </div>
                            <div style="display:flex; gap:8px;">
                                <button id="copyCodeBtn" class="btn btn-secondary">Copia codice</button>
                                <button id="openImageBtn" class="btn btn-primary">Apri immagine</button>
                            </div>
                        </div>
                    </section>

                </div>
            </div>
        </section>

        <!-- Modal immagine grande -->
        <div id="modal" aria-hidden="true"
            style="position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,0.8); z-index:1000;">
            <div class="panel" role="dialog" aria-modal="true"
                style="max-width: 95vw; max-height: 95vh; border-radius:12px; overflow:hidden; background-color: var(--card-bg);">
                <div
                    style="display:flex; justify-content:flex-end; gap:8px; padding:10px; border-bottom:1px solid var(--border-color);">
                    <button id="closeBtn" class="btn btn-secondary">Chiudi</button>
                </div>
                <div
                    style="padding: 10px; background:var(--bg-secondary); display:flex; align-items:center; justify-content:center;">
                    <img id="modalImg" alt="Immagine grande"
                        style="max-width: 90vw; max-height: 80vh; border-radius:12px;" />
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="main-footer">
            <div class="include-footer"></div>
        </footer>

        <script src="assets/js/utils.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
        <script src="assets/js/deck-viewer.js"></script>
</body>

</html>